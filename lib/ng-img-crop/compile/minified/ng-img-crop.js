!function(){"use strict";var a=angular.module("ngImgCrop",[]);a.factory("cropAreaCircle",["cropArea",function(a){var b=function(){a.apply(this,arguments),this._boxResizeBaseSize=20,this._boxResizeNormalRatio=.9,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcCirclePerimeterCoords=function(a){var b=this._size/2,c=a*(Math.PI/180),d=this._x+b*Math.cos(c),e=this._y+b*Math.sin(c);return[d,e]},b.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},b.prototype._isCoordWithinArea=function(a){return Math.sqrt((a[0]-this._x)*(a[0]-this._x)+(a[1]-this._y)*(a[1]-this._y))<this._size/2},b.prototype._isCoordWithinBoxResize=function(a){var b=this._calcResizeIconCenterCoords(),c=this._boxResizeHoverSize/2;return a[0]>b[0]-c&&a[0]<b[0]+c&&a[1]>b[1]-c&&a[1]<b[1]+c},b.prototype._drawArea=function(a,b,c){a.arc(b[0],b[1],c/2,0,2*Math.PI)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){c="nesw-resize";var e,f,g;f=a-this._posResizeStartX,g=this._posResizeStartY-b,e=f>g?this._posResizeStartSize+2*g:this._posResizeStartSize+2*f,this._size=Math.max(this._minSize,e),this._boxResizeIsHover=!0,d=!0,this._events.trigger("area-resize")}else this._isCoordWithinBoxResize([a,b])?(c="nesw-resize",this._areaIsHover=!1,this._boxResizeIsHover=!0,d=!0):this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0);return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){this._isCoordWithinBoxResize([a,b])?(this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},b}]),a.factory("cropAreaSquare",["cropArea",function(a){var b=function(){a.apply(this,arguments),this._resizeCtrlBaseRadius=10,this._resizeCtrlNormalRatio=.75,this._resizeCtrlHoverRatio=1,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return b.prototype=new a,b.prototype._calcSquareCorners=function(){var a=this._size/2;return[[this._x-a,this._y-a],[this._x+a,this._y-a],[this._x-a,this._y+a],[this._x+a,this._y+a]]},b.prototype._calcSquareDimensions=function(){var a=this._size/2;return{left:this._x-a,top:this._y-a,right:this._x+a,bottom:this._y+a}},b.prototype._isCoordWithinArea=function(a){var b=this._calcSquareDimensions();return a[0]>=b.left&&a[0]<=b.right&&a[1]>=b.top&&a[1]<=b.bottom},b.prototype._isCoordWithinResizeCtrl=function(a){for(var b=this._calcSquareCorners(),c=-1,d=0,e=b.length;d<e;d++){var f=b[d];if(a[0]>f[0]-this._resizeCtrlHoverRadius&&a[0]<f[0]+this._resizeCtrlHoverRadius&&a[1]>f[1]-this._resizeCtrlHoverRadius&&a[1]<f[1]+this._resizeCtrlHoverRadius){c=d;break}}return c},b.prototype._drawArea=function(a,b,c){var d=c/2;a.rect(b[0]-d,b[1]-d,c,c)},b.prototype.draw=function(){a.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var b=this._calcSquareCorners(),c=0,d=b.length;c<d;c++){var e=b[c];this._cropCanvas.drawIconResizeCircle(e,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===c?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},b.prototype.processMouseMove=function(a,b){var c="default",d=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=a-this._posDragStartX,this._y=b-this._posDragStartY,this._areaIsHover=!0,c="move",d=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var e,f;switch(this._resizeCtrlIsDragging){case 0:e=-1,f=-1,c="nwse-resize";break;case 1:e=1,f=-1,c="nesw-resize";break;case 2:e=-1,f=1,c="nesw-resize";break;case 3:e=1,f=1,c="nwse-resize"}var i,g=(a-this._posResizeStartX)*e,h=(b-this._posResizeStartY)*f;i=g>h?this._posResizeStartSize+h:this._posResizeStartSize+g;var j=this._size;this._size=Math.max(this._minSize,i);var k=(this._size-j)/2;this._x+=k*e,this._y+=k*f,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,d=!0,this._events.trigger("area-resize")}else{var l=this._isCoordWithinResizeCtrl([a,b]);if(l>-1){switch(l){case 0:c="nwse-resize";break;case 1:c="nesw-resize";break;case 2:c="nesw-resize";break;case 3:c="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=l,d=!0}else this._isCoordWithinArea([a,b])&&(c="move",this._areaIsHover=!0,d=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:c}),d},b.prototype.processMouseDown=function(a,b){var c=this._isCoordWithinResizeCtrl([a,b]);c>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=c,this._resizeCtrlIsHover=c,this._posResizeStartX=a,this._posResizeStartY=b,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([a,b])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=a-this._x,this._posDragStartY=b-this._y,this._events.trigger("area-move-start"))},b.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},b}]),a.factory("cropArea",["cropCanvas",function(a){var b=function(b,c){this._ctx=b,this._events=c,this._minSize=80,this._cropCanvas=new a(b),this._image=new Image,this._x=0,this._y=0,this._size=200};return b.prototype.getImage=function(){return this._image},b.prototype.setImage=function(a){this._image=a},b.prototype.getX=function(){return this._x},b.prototype.setX=function(a){this._x=a,this._dontDragOutside()},b.prototype.getY=function(){return this._y},b.prototype.setY=function(a){this._y=a,this._dontDragOutside()},b.prototype.getSize=function(){return this._size},b.prototype.setSize=function(a){this._size=Math.max(this._minSize,a),this._dontDragOutside()},b.prototype.getMinSize=function(){return this._minSize},b.prototype.setMinSize=function(a){this._minSize=a,this._size=Math.max(this._minSize,this._size),this._dontDragOutside()},b.prototype._dontDragOutside=function(){var a=this._ctx.canvas.height,b=this._ctx.canvas.width;this._size>b&&(this._size=b),this._size>a&&(this._size=a),this._x<this._size/2&&(this._x=this._size/2),this._x>b-this._size/2&&(this._x=b-this._size/2),this._y<this._size/2&&(this._y=this._size/2),this._y>a-this._size/2&&(this._y=a-this._size/2)},b.prototype._drawArea=function(){},b.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)},b.prototype.processMouseMove=function(){},b.prototype.processMouseDown=function(){},b.prototype.processMouseUp=function(){},b}]),a.factory("cropCanvas",[function(){var a=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],b=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],c=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],d=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],e=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],f=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],g=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],h=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],i={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(j){var k=function(a,b,c){return[c*a[0]+b[0],c*a[1]+b[1]]},l=function(a,b,c,d){j.save(),j.fillStyle=b,j.beginPath();var e,f=k(a[0],c,d);j.moveTo(f[0],f[1]);for(var g in a)g>0&&(e=k(a[g],c,d),j.lineTo(e[0],e[1]));j.lineTo(f[0],f[1]),j.fill(),j.closePath(),j.restore()};this.drawIconMove=function(a,b){l(e,i.moveIconFill,a,b),l(f,i.moveIconFill,a,b),l(g,i.moveIconFill,a,b),l(h,i.moveIconFill,a,b)},this.drawIconResizeCircle=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeCircleStroke,j.lineWidth=2,j.fillStyle=i.resizeCircleFill,j.beginPath(),j.arc(a[0],a[1],d,0,2*Math.PI),j.fill(),j.stroke(),j.closePath(),j.restore()},this.drawIconResizeBoxBase=function(a,b,c){var d=b*c;j.save(),j.strokeStyle=i.resizeBoxStroke,j.lineWidth=2,j.fillStyle=i.resizeBoxFill,j.fillRect(a[0]-d/2,a[1]-d/2,d,d),j.strokeRect(a[0]-d/2,a[1]-d/2,d,d),j.restore()},this.drawIconResizeBoxNESW=function(a,d,e){this.drawIconResizeBoxBase(a,d,e),l(b,i.resizeBoxArrowFill,a,e),l(c,i.resizeBoxArrowFill,a,e)},this.drawIconResizeBoxNWSE=function(b,c,e){this.drawIconResizeBoxBase(b,c,e),l(a,i.resizeBoxArrowFill,b,e),l(d,i.resizeBoxArrowFill,b,e)},this.drawCropArea=function(a,b,c,d){var e=a.width/j.canvas.width,f=a.height/j.canvas.height,g=b[0]-c/2,h=b[1]-c/2;j.save(),j.strokeStyle=i.areaOutline,j.lineWidth=2,j.beginPath(),d(j,b,c),j.stroke(),j.clip(),c>0&&j.drawImage(a,g*e,h*f,c*e,c*f,g,h,c,c),j.beginPath(),d(j,b,c),j.stroke(),j.clip(),j.restore()}}}]),a.service("cropEXIF",[function(){function g(a){return!!a.exifdata}function h(a,b){b=b||a.match(/^data\:([^\;]+)\;base64,/im)[1]||"",a=a.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;g<d;g++)f[g]=c.charCodeAt(g);return e}function i(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)},c.send()}function j(b,c){function d(a){var d=k(a),e=l(a);b.exifdata=d||{},b.iptcdata=e||{},c&&c.call(b)}if(b.src)if(/^data\:/i.test(b.src)){var e=h(b.src);d(e)}else if(/^blob\:/i.test(b.src)){var f=new FileReader;f.onload=function(a){d(a.target.result)},i(b.src,function(a){f.readAsArrayBuffer(a)})}else{var g=new XMLHttpRequest;g.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";d(g.response),g=null},g.open("GET",b.src,!0),g.responseType="arraybuffer",g.send(null)}else if(window.FileReader&&(b instanceof window.Blob||b instanceof window.File)){var f=new FileReader;f.onload=function(b){a&&console.log("Got file of length "+b.target.result.byteLength),d(b.target.result)},f.readAsArrayBuffer(b)}}function k(b){var c=new DataView(b);if(a&&console.log("Got file of length "+b.byteLength),255!=c.getUint8(0)||216!=c.getUint8(1))return a&&console.log("Not a valid JPEG"),!1;for(var f,d=2,e=b.byteLength;d<e;){if(255!=c.getUint8(d))return a&&console.log("Not a valid marker at offset "+d+", found: "+c.getUint8(d)),!1;if(f=c.getUint8(d+1),a&&console.log(f),225==f)return a&&console.log("Found 0xFFE1 marker"),r(c,d+4,c.getUint16(d+2)-2);d+=2+c.getUint16(d+2)}}function l(b){var c=new DataView(b);if(a&&console.log("Got file of length "+b.byteLength),255!=c.getUint8(0)||216!=c.getUint8(1))return a&&console.log("Not a valid JPEG"),!1;for(var d=2,e=b.byteLength,f=function(a,b){return 56===a.getUint8(b)&&66===a.getUint8(b+1)&&73===a.getUint8(b+2)&&77===a.getUint8(b+3)&&4===a.getUint8(b+4)&&4===a.getUint8(b+5)};d<e;){if(f(c,d)){var g=c.getUint8(d+7);g%2!==0&&(g+=1),0===g&&(g=4);var h=d+8+g,i=c.getUint16(d+6+g);return n(b,h,i)}d++}}function n(a,b,c){for(var f,g,h,i,j,d=new DataView(a),e={},k=b;k<b+c;)28===d.getUint8(k)&&2===d.getUint8(k+1)&&(i=d.getUint8(k+2),i in m&&(h=d.getInt16(k+3),j=h+5,g=m[i],f=q(d,k+5,h),e.hasOwnProperty(g)?e[g]instanceof Array?e[g].push(f):e[g]=[e[g],f]:e[g]=f)),k++;return e}function o(b,c,d,e,f){var i,j,k,g=b.getUint16(d,!f),h={};for(k=0;k<g;k++)i=d+12*k+2,j=e[b.getUint16(i,!f)],!j&&a&&console.log("Unknown tag: "+b.getUint16(i,!f)),h[j]=p(b,i,c,d,f);return h}function p(a,b,c,d,e){var i,j,k,l,m,n,f=a.getUint16(b+2,!e),g=a.getUint32(b+4,!e),h=a.getUint32(b+8,!e)+c;switch(f){case 1:case 7:if(1==g)return a.getUint8(b+8,!e);for(i=g>4?h:b+8,j=[],l=0;l<g;l++)j[l]=a.getUint8(i+l);return j;case 2:return i=g>4?h:b+8,q(a,i,g-1);case 3:if(1==g)return a.getUint16(b+8,!e);for(i=g>2?h:b+8,j=[],l=0;l<g;l++)j[l]=a.getUint16(i+2*l,!e);return j;case 4:if(1==g)return a.getUint32(b+8,!e);for(j=[],l=0;l<g;l++)j[l]=a.getUint32(h+4*l,!e);return j;case 5:if(1==g)return m=a.getUint32(h,!e),n=a.getUint32(h+4,!e),k=new Number(m/n),k.numerator=m,k.denominator=n,k;for(j=[],l=0;l<g;l++)m=a.getUint32(h+8*l,!e),n=a.getUint32(h+4+8*l,!e),j[l]=new Number(m/n),j[l].numerator=m,j[l].denominator=n;return j;case 9:if(1==g)return a.getInt32(b+8,!e);for(j=[],l=0;l<g;l++)j[l]=a.getInt32(h+4*l,!e);return j;case 10:if(1==g)return a.getInt32(h,!e)/a.getInt32(h+4,!e);for(j=[],l=0;l<g;l++)j[l]=a.getInt32(h+8*l,!e)/a.getInt32(h+4+8*l,!e);return j}}function q(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}function r(f,g){if("Exif"!=q(f,g,4))return a&&console.log("Not valid EXIF data! "+q(f,g,4)),!1;var h,i,j,k,l,m=g+6;if(18761==f.getUint16(m))h=!1;else{if(19789!=f.getUint16(m))return a&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;h=!0}if(42!=f.getUint16(m+2,!h))return a&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var n=f.getUint32(m+4,!h);if(n<8)return a&&console.log("Not valid TIFF data! (First offset less than 8)",f.getUint32(m+4,!h)),!1;if(i=o(f,m,m+n,c,h),i.ExifIFDPointer){k=o(f,m,m+i.ExifIFDPointer,b,h);for(j in k){switch(j){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":k[j]=e[j][k[j]];break;case"ExifVersion":case"FlashpixVersion":k[j]=String.fromCharCode(k[j][0],k[j][1],k[j][2],k[j][3]);break;case"ComponentsConfiguration":k[j]=e.Components[k[j][0]]+e.Components[k[j][1]]+e.Components[k[j][2]]+e.Components[k[j][3]]}i[j]=k[j]}}if(i.GPSInfoIFDPointer){l=o(f,m,m+i.GPSInfoIFDPointer,d,h);for(j in l){switch(j){case"GPSVersionID":l[j]=l[j][0]+"."+l[j][1]+"."+l[j][2]+"."+l[j][3]}i[j]=l[j]}}return i}var a=!1,b=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},c=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},d=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},e=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},m={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(a,b){return!((a instanceof Image||a instanceof HTMLImageElement)&&!a.complete)&&(g(a)?b&&b.call(a):j(a,b),!0)},this.getTag=function(a,b){if(g(a))return a.exifdata[b]},this.getAllTags=function(a){if(!g(a))return{};var b,c=a.exifdata,d={};for(b in c)c.hasOwnProperty(b)&&(d[b]=c[b]);return d},this.pretty=function(a){if(!g(a))return"";var b,c=a.exifdata,d="";for(b in c)c.hasOwnProperty(b)&&(d+="object"==typeof c[b]?c[b]instanceof Number?b+" : "+c[b]+" ["+c[b].numerator+"/"+c[b].denominator+"]\r\n":b+" : ["+c[b].length+" values]\r\n":b+" : "+c[b]+"\r\n");return d},this.readFromBinaryFile=function(a){return k(a)}}]),a.factory("cropHost",["$document","cropAreaCircle","cropAreaSquare","cropEXIF",function(a,b,c,d){var e=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}};return function(f,g,h){function q(){i.clearRect(0,0,i.canvas.width,i.canvas.height),null!==j&&(i.drawImage(j,0,0,i.canvas.width,i.canvas.height),i.save(),i.fillStyle="rgba(0, 0, 0, 0.65)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore(),k.draw())}var i=null,j=null,k=null,l=[100,100],m=[300,300],n=200,o="image/png",p=null,r=function(){if(null!==j){k.setImage(j);var a=[j.width,j.height],b=j.width/j.height,c=a;c[0]>m[0]?(c[0]=m[0],c[1]=c[0]/b):c[0]<l[0]&&(c[0]=l[0],c[1]=c[0]/b),c[1]>m[1]?(c[1]=m[1],c[0]=c[1]*b):c[1]<l[1]&&(c[1]=l[1],c[0]=c[1]*b),f.prop("width",c[0]).prop("height",c[1]).css({"margin-left":-c[0]/2+"px","margin-top":-c[1]/2+"px"}),k.setX(i.canvas.width/2),k.setY(i.canvas.height/2),k.setSize(Math.min(200,i.canvas.width/2,i.canvas.height/2))}else f.prop("width",0).prop("height",0).css({"margin-top":0});q()},s=function(a){return angular.isDefined(a.changedTouches)?a.changedTouches:a.originalEvent.changedTouches},t=function(a){if(null!==j){var c,d,b=e(i.canvas);"touchmove"===a.type?(c=s(a)[0].pageX,d=s(a)[0].pageY):(c=a.pageX,d=a.pageY),k.processMouseMove(c-b.left,d-b.top),q()}},u=function(a){if(a.preventDefault(),a.stopPropagation(),null!==j){var c,d,b=e(i.canvas);"touchstart"===a.type?(c=s(a)[0].pageX,d=s(a)[0].pageY):(c=a.pageX,d=a.pageY),k.processMouseDown(c-b.left,d-b.top),q()}},v=function(a){if(null!==j){var c,d,b=e(i.canvas);"touchend"===a.type?(c=s(a)[0].pageX,d=s(a)[0].pageY):(c=a.pageX,d=a.pageY),k.processMouseUp(c-b.left,d-b.top),q()}};this.getResultImageDataURI=function(){var a,b;return b=angular.element("<canvas></canvas>")[0],a=b.getContext("2d"),b.width=n,b.height=n,null!==j&&a.drawImage(j,(k.getX()-k.getSize()/2)*(j.width/i.canvas.width),(k.getY()-k.getSize()/2)*(j.height/i.canvas.height),k.getSize()*(j.width/i.canvas.width),k.getSize()*(j.height/i.canvas.height),0,0,n,n),null!==p?b.toDataURL(o,p):b.toDataURL(o)},this.setNewImageSource=function(a){if(j=null,r(),h.trigger("image-updated"),a){var b=new Image;"http"===a.substring(0,4).toLowerCase()&&(b.crossOrigin="anonymous"),b.onload=function(){h.trigger("load-done"),d.getData(b,function(){var a=d.getTag(b,"Orientation");if([3,6,8].indexOf(a)>-1){var c=document.createElement("canvas"),e=c.getContext("2d"),f=b.width,g=b.height,i=0,k=0,l=0;switch(a){case 3:i=-b.width,k=-b.height,l=180;break;case 6:f=b.height,g=b.width,k=-b.height,l=90;break;case 8:f=b.height,g=b.width,i=-b.width,l=270}c.width=f,c.height=g,e.rotate(l*Math.PI/180),e.drawImage(b,i,k),j=new Image,j.onload=function(){r(),h.trigger("image-updated")},j.src=c.toDataURL("image/png")}else j=b,r(),h.trigger("image-updated")})},b.onerror=function(){h.trigger("load-error")},h.trigger("load-start"),b.src=a}},this.setMaxDimensions=function(a,b){if(m=[a,b],null!==j){var c=i.canvas.width,d=i.canvas.height,e=[j.width,j.height],g=j.width/j.height,h=e;h[0]>m[0]?(h[0]=m[0],h[1]=h[0]/g):h[0]<l[0]&&(h[0]=l[0],h[1]=h[0]/g),h[1]>m[1]?(h[1]=m[1],h[0]=h[1]*g):h[1]<l[1]&&(h[1]=l[1],h[0]=h[1]*g),f.prop("width",h[0]).prop("height",h[1]).css({"margin-left":-h[0]/2+"px","margin-top":-h[1]/2+"px"});var n=i.canvas.width/c,o=i.canvas.height/d,p=Math.min(n,o);k.setX(k.getX()*n),k.setY(k.getY()*o),k.setSize(k.getSize()*p)}else f.prop("width",0).prop("height",0).css({"margin-top":0});q()},this.setAreaMinSize=function(a){a=parseInt(a,10),isNaN(a)||(k.setMinSize(a),q())},this.setResultImageSize=function(a){a=parseInt(a,10),isNaN(a)||(n=a)},this.setResultImageFormat=function(a){o=a},this.setResultImageQuality=function(a){a=parseFloat(a),!isNaN(a)&&a>=0&&a<=1&&(p=a)},this.setAreaType=function(a){var d=k.getSize(),e=k.getMinSize(),f=k.getX(),g=k.getY(),l=b;"square"===a&&(l=c),k=new l(i,h),k.setMinSize(e),k.setSize(d),k.setX(f),k.setY(g),null!==j&&k.setImage(j),q()},i=f[0].getContext("2d"),k=new b(i,h),a.on("mousemove",t),f.on("mousedown",u),a.on("mouseup",v),a.on("touchmove",t),f.on("touchstart",u),a.on("touchend",v),this.destroy=function(){a.off("mousemove",t),f.off("mousedown",u),a.off("mouseup",t),a.off("touchmove",t),f.off("touchstart",u),a.off("touchend",t),f.remove()}}}]),a.factory("cropPubSub",[function(){return function(){var a={};this.on=function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},this.trigger=function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}]),a.directive("imgCrop",["$timeout","cropHost","cropPubSub",function(a,b,c){return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(a){a.events=new c}],link:function(c,d){var g,e=c.events,f=new b(d.find("canvas"),{},e),h=function(a){var b=f.getResultImageDataURI();g!==b&&(g=b,angular.isDefined(a.resultImage)&&(a.resultImage=b),a.onChange({$dataURI:a.resultImage}))},i=function(b){return function(){a(function(){c.$apply(function(a){b(a)})})}};e.on("load-start",i(function(a){a.onLoadBegin({})})).on("load-done",i(function(a){a.onLoadDone({})})).on("load-error",i(function(a){a.onLoadError({})})).on("area-move area-resize",i(function(a){a.changeOnFly&&h(a)})).on("area-move-end area-resize-end image-updated",i(function(a){h(a)})),c.$watch("image",function(){f.setNewImageSource(c.image)}),c.$watch("areaType",function(){f.setAreaType(c.areaType),h(c)}),c.$watch("areaMinSize",function(){f.setAreaMinSize(c.areaMinSize),h(c)}),c.$watch("resultImageSize",function(){f.setResultImageSize(c.resultImageSize),h(c)}),c.$watch("resultImageFormat",function(){f.setResultImageFormat(c.resultImageFormat),h(c)}),c.$watch("resultImageQuality",function(){f.setResultImageQuality(c.resultImageQuality),h(c)}),c.$watch(function(){return[d[0].clientWidth,d[0].clientHeight]},function(a){f.setMaxDimensions(a[0],a[1]),h(c)},!0),c.$on("$destroy",function(){f.destroy()})}}}])}();